# load_chapter_01.py
from neo4j import GraphDatabase, exceptions

# --- ۱. تنظیمات اتصال ---
NEO4J_URI = "bolt://localhost:7687"
NEO4J_USER = "neo4j"
NEO4J_PASSWORD = "assist123" # <-- رمز عبور خود را اینجا وارد کنید

# --- ۲. داده‌های استخراج شده و تصحیح شده از فصل ۰۱ (تخریب) ---

# الف) گره فصل
chapter_data = {
    "chapter_id": "01", 
    "title": "عملیات تخریب و برچیدن"
}

# ب) گره‌های گروه‌ها
groups_data = [
    {"group_id": "0101", "title": "بوته کنی کندن و جابجایی نهال و درخت"},
    {"group_id": "0102", "title": "سوراخ کاری و شیارزنی"},
    {"group_id": "0103", "title": "تخریب کلی ساختمان با مصالح بنایی، خشتی و چینه ای"},
    {"group_id": "0104", "title": "تخریب سطوح، تفکیک و دسته بندی کردن و برچیدن سنگ لاشه و قلوه"},
    {"group_id": "0105", "title": "برچیدن فرش کف، سفال بام، عایق، جدول و تراشیدن اندود"},
    {"group_id": "0106", "title": "برچیدن کارچوبی، صفحات پیش ساخته، کفپوش، دیوارپوش و شیشه نشکن"},
    {"group_id": "0107", "title": "برچیدن کار فولادی"},
    {"group_id": "0108", "title": "برچیدن تاسیسات مکانیکی و برقی"},
    {"group_id": "0109", "title": "کندن و تراشیدن آسفالت و برش بتن"}
]

# ج) گره‌های ردیف‌ها (Items) - نسخه تصحیح شده
items_data = [
    {"item_id": "010101", "description": "کندن و خارج کردن بوته و ریشه های مربوط در زمینهای پوشیده از آنها.", "unit": "متر مربع", "price": 2890, "type": "Base"},
    {"item_id": "010102", "description": "کندن و یا بریدن و در صورت لزوم ریشه کن کردن هر نوع نهال در صورتی که محیط بن آن کمتر از ۱۵ سانتی متر باشد به ازای هر ۵ سانتی متر محیط بن کسر ۵ سانتی متر به تناسب محاسبه میشود و حمل آن به خارج کارگاه", "unit": "اصله", "price": 101000, "type": "Base"},
    {"item_id": "010121", "description": "جابجایی درخت یا نهال در صورتی که محیط بن آن تا ۴۰ سانتی متر باشد.", "unit": "اصله", "price": 28586000, "type": "Base"},
    {"item_id": "010122", "description": "اضافه بها به ردیف ۰۱۰۱۲۱ به ازای هر سانتی متر که به محیط بن درخت اضافه شود مازاد بر ۴۰ سانتی متر تا ۱۰۰ سانتی متر.", "unit": "اصله", "price": 1524000, "type": "AddedValue"},
    {"item_id": "010123", "description": "جابجایی درخت در صورتی که محیط بن آن ۱۰۰ سانتی متر باشد.", "unit": "اصله", "price": 118920000, "type": "Base"}, # تصحیح شد (۱۰۰ سانت)
    {"item_id": "010124", "description": "اضافه بها به ردیف ۰۱۰۱۲۳ به ازای هر سانتی متر که به محیط بن درخت اضافه شود مازاد بر ۱۰۰ سانتی متر تا ۱۲۰ سانتی متر", "unit": "اصله", "price": 2628000, "type": "AddedValue"},
    {"item_id": "010125", "description": "جابجایی درخت در صورتی که محیط بن آن ۱۲۰ سانتی متر باشد.", "unit": "اصله", "price": 171519000, "type": "Base"},
    {"item_id": "010126", "description": "اضافه بها به ردیف ۰۱۰۱۲۵ به ازای هر سانتی متر که به محیط بن درخت اضافه شود مازاد بر ۱۲۰ سانتی متر تا ۱۵۰ سانتی متر.", "unit": "اصله", "price": 3584000, "type": "AddedValue"},
    {"item_id": "010127", "description": "جابجایی درخت در صورتی که محیط بن آن ۱۵۰ سانتی متر و بیشتر باشد.", "unit": "اصله", "price": 279767000, "type": "Base"},
    {"item_id": "010201", "description": "سوراخ کردن سطوح بنایی به سطح مقطع تا ۰.۰۰۰۵ متر مربع به انضمام بریدن میلگردها در صورت لزوم.", "unit": "مترطول", "price": 2093000, "type": "Base"},
    {"item_id": "010202", "description": "سوراخ کردن سطوح بنایی به سطح مقطع بیش از ۰.۰۰۰۵ تا ۰.۰۱ متر مربع به انضمام بریدن میلگردها در صورت لزوم", "unit": "مترطول", "price": 4186000, "type": "Base"},
    {"item_id": "010203", "description": "سوراخ کردن سطوح بنایی به سطح مقطع بیش از ۰.۰۱ تا ۰.۳ متر مربع به انضمام بریدن میلگردها در صورت لزوم.", "unit": "مترطول", "price": 8373000, "type": "Base"},
    {"item_id": "010204", "description": "سوراخ کردن سطوح بتنی و بتن مسلح به سطح مقطع تا ۰.۰۰۰۵ متر مربع به انضمام بریدن میلگردها در صورت لزوم.", "unit": "مترطول", "price": 4925000, "type": "Base"},
    {"item_id": "010205", "description": "سوراخ کردن سطوح بتنی و بتن مسلح به سطح مقطع بیش از ۰.۰۰۰۵ تا ۰.۰۵ متر مربع به انضمام بریدن میلگردها در صورت لزوم.", "unit": "مترطول", "price": 11962000, "type": "Base"},
    {"item_id": "010206", "description": "سوراخ کردن سطوح بتنی و بتن مسلح به سطح مقطع بیش از ۰.۰۵ تا ۰.۱۵ متر مربع به انضمام بریدن میلگردها در صورت لزوم.", "unit": "مترطول", "price": 16747000, "type": "Base"},
    {"item_id": "010207", "description": "ایجاد شیار با سطح مقطع تا ۲۰ سانتی متر مربع در سطوح بنایی.", "unit": "مترطول", "price": 423000, "type": "Base"},
    {"item_id": "010208", "description": "ایجاد شیار با سطح مقطع بیش از ۲۰ تا ۴۰ سانتی متر مربع در سطوح بنایی.", "unit": "مترطول", "price": 846000, "type": "Base"},
    {"item_id": "010209", "description": "اضافه بها به ردیف ۰۱۰۲۰۸ به ازای هر یک سانتی متر مربع که به سطح مقطع اضافه شود تا سطح مقطع حداکثر ۱۰۰ سانتی متر مربع.", "unit": "مترطول", "price": 25400, "type": "AddedValue"},
    {"item_id": "010210", "description": "ایجاد شیار با سطح مقطع تا ۲۰ سانتی متر مربع در سطوح بتنی.", "unit": "مترطول", "price": 2114000, "type": "Base"},
    {"item_id": "010211", "description": "ایجاد شیار با سطح مقطع بیش از ۲۰ تا ۴۰ سانتی متر مربع در سطوح بتنی.", "unit": "مترطول", "price": 2820000, "type": "Base"},
    {"item_id": "010212", "description": "اضافه بها به ردیف ۰۱۰۲۱۱ به ازای هر یک سانتی متر مربع که به سطح مقطع اضافه شود تا سطح مقطع حداکثر ۱۰۰ سانتی متر مربع.", "unit": "مترطول", "price": 112500, "type": "AddedValue"},
    {"item_id": "010220", "description": "سوراخ کردن سطوح بتنی و بتن مسلح به قطر تا ۴ سانتی متر با استفاده از ابزار دورانی چکشی", "unit": "مترطول", "price": 5799000, "type": "Base"},
    {"item_id": "010230", "description": "سوراخ کردن سطوح بتنی و بتن مسلح به قطر تا ۱۵ سانتی متر به روش مغزه گیری", "unit": "مترطول", "price": 16398000, "type": "Base"},
    {"item_id": "010301", "description": "تخریب کلی ساختمانهای با مصالح خشتی و چینه ای.", "unit": "متر مربع", "price": 3065000, "type": "Base"},
    {"item_id": "010302", "description": "تخریب کلی ساختمانهای با مصالح بنایی غیر از خشتی و چینه ای.", "unit": "متر مربع", "price": 3623000, "type": "Base"},
    {"item_id": "010401", "description": "تخریب بناییهای با مصالح خشتی و چینه ای.", "unit": "متر مکعب", "price": 1129000, "type": "Base"},
    {"item_id": "010402", "description": "تخریب بنایی های با مصالح غیر از خشتی و چینه ای که با ملات ماسه سیمان یا با تارد چیده شده باشد.", "unit": "متر مکعب", "price": 1757000, "type": "Base"},
    {"item_id": "010403", "description": "تخریب بنایی های با مصالح غیر از خشتی و چینه ای که با ملات گل آهک ماسه آهک یا گچ و خاک چیده شده باشد.", "unit": "متر مکعب", "price": 1478000, "type": "Base"},
    {"item_id": "010404", "description": "تخریب سقف آجری با تیرآهن یا بدون تیرآهن به هر ضخامت با برداشتن تیرآهن های مربوط.", "unit": "متر مکعب", "price": 1416000, "type": "Base"},
    {"item_id": "010405", "description": "تخریب بتن غیر مسلح.", "unit": "متر مکعب", "price": 15775000, "type": "Base"},
    {"item_id": "010406", "description": "تخریب بتن مسلح به انضمام بریدن میلگردها.", "unit": "متر مکعب", "price": 22928000, "type": "Base"},
    {"item_id": "010407", "description": "تخریب شفته با هر عیار.", "unit": "متر مکعب", "price": 3432000, "type": "Base"},
    {"item_id": "010408", "description": "تفکیک دسته بندی و یا چیدن آجرها بلوک ها سنگها و مصالح مشابه حاصل از تخریب یا برچیدن", "unit": "متر مکعب", "price": 2093000, "type": "Base"},
    {"item_id": "010409", "description": "تخریب سقف تیرچه و بلوک با هر نوع مصالح و به هر ضخامت به انضمام بریدن تیرچه و میلگردها.", "unit": "متر مکعب", "price": 11468000, "type": "Base"},
    {"item_id": "010410", "description": "برچیدن سنگ لاشه یا قلوه که به صورت خشکه چینی اجرا شده باشد.", "unit": "متر مکعب", "price": 1469000, "type": "Base"},
    {"item_id": "010412", "description": "تخریب انواع دیوار پانلی مشبک عایق دار و دیوار پانلی ماندگار", "unit": "متر مکعب", "price": 1753000, "type": "Base"},
    {"item_id": "010501", "description": "برچیدن پله موزاییکی یا سنگی ریشه دار به هر عرض و ارتفاع.", "unit": "مترطول", "price": 1046000, "type": "Base"},
    {"item_id": "010502", "description": "برچیدن فرش کف آجری موزاییکی یا کفپوشهای بتنی همراه با ملات مربوط", "unit": "متر مربع", "price": 350500, "type": "Base"},
    {"item_id": "010503", "description": "برچیدن هر نوع سنگ پلاک از کلیه سطوح اجرا شده و تراشیدن ملات مربوط در صورت لزوم.", "unit": "متر مربع", "price": 613500, "type": "Base"},
    {"item_id": "010504", "description": "برچیدن فرش کف از سنگهای لاشه ریشه دار با قلوه همراه با ملات مربوط.", "unit": "متر مربع", "price": 538500, "type": "Base"},
    {"item_id": "010505", "description": "برچیدن کاشی سرامیکی و تراشیدن چسباننده مربوط در صورت لزوم.", "unit": "متر مربع", "price": 573500, "type": "Base"},
    {"item_id": "010506", "description": "تراشیدن کاه گل پشت بام به هر ضخامت.", "unit": "متر مربع", "price": 194500, "type": "Base"},
    {"item_id": "010507", "description": "تراشیدن اندود کاه گل از روی کلیه سطوح همراه با اندود گچ روی آن در صورت وجود.", "unit": "متر مربع", "price": 209500, "type": "Base"},
    {"item_id": "010508", "description": "تراشیدن اندود گچ و خاک از روی کلیه سطوح همراه با اندود گچ روی آن در صورت وجود.", "unit": "متر مربع", "price": 418500, "type": "Base"},
    {"item_id": "010509", "description": "تراشیدن اندودهای ماسه سیمان باتارد یا ماسه آهک از روی کلیه سطوح به همراه اندود رویه آن در صورت وجود.", "unit": "متر مربع", "price": 1196000, "type": "Base"},
    {"item_id": "010510", "description": "خارج کردن بندهای موجود با هر نوع مصالح و پاک کردن درزها.", "unit": "مترطول", "price": 13300, "type": "Base"},
    {"item_id": "010512", "description": "برچیدن سقفهای متشکل از تیر چوبی حصیر توفال و اندود روی آن بطور کامل.", "unit": "متر مربع", "price": 2940000, "type": "Base"},
    {"item_id": "010513", "description": "برچیدن هر نوع سفال بام", "unit": "متر مربع", "price": 198500, "type": "Base"},
    {"item_id": "010514", "description": "برچیدن عایق رطوبتی اعم از قیر و گونی عایق پیش ساخته و مانند آن.", "unit": "متر مربع", "price": 180500, "type": "Base"},
    {"item_id": "010515", "description": "برچیدن جدولهای بتنی پیش ساخته و سنگی با هر ابعاد.", "unit": "مترطول", "price": 580000, "type": "Base"},
    {"item_id": "010516", "description": "برچیدن هر نوع عایق حرارتی با هر ضخامت و وزن مخصوص.", "unit": "متر مربع", "price": 83700, "type": "Base"},
    {"item_id": "010517", "description": "کسربها به ردیفهای ۰۱۰۵۰۲، ۰۱۰۵۰۳ و ۰۱۰۵۰۵ در صورتی که مصالح مربوط بدون استفاده از ملات و به طریق خشک نصب شده باشند.", "unit": "متر مربع", "price": -104500, "type": "SubtractedValue"},
    {"item_id": "010518", "description": "تراشیدن هر نوع اندود پاششی مقاوم در برابر آتش به سطح تا ۰/۰۵ متر مربع.", "unit": "عدد", "price": 173000, "type": "Base"},
    {"item_id": "010601", "description": "برچیدن تخته زیر شیروانی یا توفال سقف.", "unit": "متر مربع", "price": 318500, "type": "Base"},
    {"item_id": "010602", "description": "برچیدن لاپه چوبی به طور کامل.", "unit": "متر مربع", "price": 1592000, "type": "Base"},
    {"item_id": "010603", "description": "برچیدن خرپای چوبی به انضمام اتصالات و تیرریزی های چوبی بین خرپاها", "unit": "متر مربع", "price": 1592000, "type": "Base"},
    {"item_id": "010604", "description": "برچیدن در و پنجره چوبی همراه با چهارچوب مربوط", "unit": "عدد", "price": 1046000, "type": "Base"},
    {"item_id": "010605", "description": "برچیدن دیوار جدا کننده فولادی چوبی شیشه ای و مانند آن یا ترکیبی از آنها.", "unit": "متر مربع", "price": 837500, "type": "Base"},
    {"item_id": "010606", "description": "باز کردن قفل و یراق آلات در و پنجره، لولا، چفت دستگیره و مانند آن.", "unit": "لنگه", "price": 423000, "type": "Base"},
    {"item_id": "010607", "description": "برچیدن زیرسازی سطوح کاذب با مصالح چوبی.", "unit": "متر مربع", "price": 427500, "type": "Base"},
    {"item_id": "010608", "description": "برچیدن انواع صفحات گچی یا سیمانی دیواری و سقفی به همراه زیرسازی مربوط", "unit": "متر مربع", "price": 567500, "type": "Base"},
    {"item_id": "010609", "description": "برچیدن پانلهای ساندویچی فلزی دیواری و سقفی.", "unit": "متر مربع", "price": 318500, "type": "Base"},
    {"item_id": "010610", "description": "برچیدن انواع سقف کاذب کف پوش یا دیوارپوش پلیمری چوبی آلومینیومی به همراه زیرسازی مربوط در صورت لزوم.", "unit": "متر مربع", "price": 681000, "type": "Base"},
    {"item_id": "010611", "description": "برچیدن تایلهای سقفی از هر نوع به صورت مشبک و به گونه ای که تایلها سالم حفظ شود به همراه زیرسازی مربوط.", "unit": "متر مربع", "price": 426000, "type": "Base"},
    {"item_id": "010612", "description": "برچیدن شیشه نشکن اعم از ثابت یا بازشو به گونه ای که شیشه ها سالم حفظ شود.", "unit": "متر مربع", "price": 558000, "type": "Base"},
    {"item_id": "010701", "description": "برچیدن پنجره یا درهای فلزی همراه با قاب مربوط یا هر نوع چهارچوب فلزی دیگر.", "unit": "عدد", "price": 1395000, "type": "Base"},
    {"item_id": "010702", "description": "برچیدن و صاف کردن در حد امکان و دورچین کردن اهن ورق صاف یا کرکره ای از روی شیروانی سقف ها سایه بان جان پناه ، کف پنجره و مانند آن بر حسب سطح برچیده شده.", "unit": "متر مربع", "price": 424500, "type": "Base"},
    {"item_id": "010704", "description": "برچیدن ورقهای صاف یا موج دار آزبست سیمان بر حسب سطح برچیده شده.", "unit": "متر مربع", "price": 424500, "type": "Base"},
    {"item_id": "010705", "description": "برچیدن هر نوع اسکلت فولادی ساختمان برج آب فولادی و مانند آن با هر نوع تیرآهن ناودانی نبشی لوله و ورق و سایر پروفیلهای فولادی با هرگونه اتصال", "unit": "کیلوگرم", "price": 30900, "type": "Base"},
    {"item_id": "010706", "description": "برچیدن فنس از توری سیمی سیم خاردار با شبکه پیش جوش شده با پایه های مربوط", "unit": "متر مربع", "price": 523500, "type": "Base"},
    {"item_id": "010707", "description": "برچیدن صفحات رابیتس از سطوح کاذب همراه اندود روی آن در صورت وجود", "unit": "متر مربع", "price": 279000, "type": "Base"},
    {"item_id": "010708", "description": "برچیدن زیرسازی فولادی سطوح کاذب و نمای ساختمان از نبشی سپری میلگرد پروفیلهای توخالی و مانند آن.", "unit": "کیلوگرم", "price": 73100, "type": "Base"},
    {"item_id": "010709", "description": "برچیدن هر نوع نرده فلزی و چوبی", "unit": "متر مربع", "price": 279000, "type": "Base"},
    {"item_id": "010710", "description": "اضافه بها به ردیف ۰۱۰۷۰۵ در صورتی که قطعاتی از اعضای اسکلت فولادی به صورت مجزا و پراکنده مانند تیر و ستون برچیده شوند.", "unit": "کیلوگرم", "price": 59000, "type": "AddedValue"},
    {"item_id": "010711", "description": "برچیدن روکش روی ستونها دیوارها و نما از هر نوع ورق فلزی", "unit": "متر مربع", "price": 635500, "type": "Base"},
    {"item_id": "010712", "description": "برچیدن هر نوع سازه فضاکار با هرگونه اتصال.", "unit": "کیلوگرم", "price": 136500, "type": "Base"},
    {"item_id": "010713", "description": "برچیدن در و پنجره آلومینیومی یا U.P.V.C.", "unit": "عدد", "price": 1061000, "type": "Base"},
    {"item_id": "010714", "description": "برچیدن هر نوع کانال هوا همراه با عایق آن در صورت وجود بر حسب متر مربع کانال.", "unit": "متر مربع", "price": 159000, "type": "Base"},
    {"item_id": "010715", "description": "برچیدن هر نوع سازه ساخته شده با تور سنگ (گابیون) و دسته بندی کردن مصالح و سنگهای مربوط.", "unit": "متر مکعب", "price": 1674000, "type": "Base"},
    {"item_id": "010716", "description": "برچیدن ورق یا پانلهای پلیمری از روی شیروانی، سقف سایه بان و مانند آن به هر ضخامت بر حسب سطح برچیده شده.", "unit": "متر مربع", "price": 320500, "type": "Base"},
    {"item_id": "010801", "description": "برچیدن هر نوع سینک ظرفشویی دست شویی بیده توالت غربی فلاش تانک", "unit": "دستگاه", "price": 850000, "type": "Base"},
    {"item_id": "010802", "description": "برچیدن توالت شرقی زیر دوشی و وان حمام.", "unit": "دستگاه", "price": 849500, "type": "Base"},
    {"item_id": "010803", "description": "برچیدن لوله فلزی و هر نوع لوله پلیمری غیر مدفون با قطر تا ۲ اینچ به همراه اتصالات مربوط", "unit": "مترطول", "price": 187500, "type": "Base"},
    {"item_id": "010804", "description": "برچیدن لوله فلزی و هر نوع لوله پلیمری مدفون در مصالح بنایی با قطر تا ۲ اینچ به همراه اتصالات مربوط.", "unit": "مترطول", "price": 232000, "type": "Base"},
    {"item_id": "010805", "description": "بر چیدن لوله فلزی و هر نوع لوله پلیمری غیر مدفون با قطر بیش از ۲ اینچ به همراه اتصالات مربوط.", "unit": "مترطول", "price": 318500, "type": "Base"},
    {"item_id": "010806", "description": "برچیدن لوله فلزی و هر نوع لوله پلیمری مدفون در مصالح بنایی با قطر بیش از ۲ اینچ به همراه اتصالات مربوط.", "unit": "مترطول", "price": 375000, "type": "Base"},
    {"item_id": "010808", "description": "برچیدن سیمهای برق تلفن زنگ اخبار و مانند آن سیم هایی که داخل یک لوله باشند یک رشته محسوب می شوند.", "unit": "مترطول", "price": 18200, "type": "Base"},
    {"item_id": "010809", "description": "برچیدن چراغ سقفی و پنکه سقفی یا موارد مشابه آن.", "unit": "عدد", "price": 522500, "type": "Base"},
    {"item_id": "010810", "description": "برچیدن کلید پریز و موارد مشابه", "unit": "عدد", "price": 159000, "type": "Base"},
    {"item_id": "010811", "description": "برچیدن هر نوع کابل از کلیه سطوح", "unit": "مترطول", "price": 56600, "type": "Base"},
    {"item_id": "010812", "description": "برچیدن سینی و نردبان کابل به همراه بست اتصالات و تکیه گاه مربوط.", "unit": "مترطول", "price": 318500, "type": "Base"},
    {"item_id": "010813", "description": "برچیدن دریچه هوا، دمپر و مانند آن.", "unit": "عدد", "price": 318500, "type": "Base"},
    {"item_id": "010814", "description": "برچیدن شیرآلات بهداشتی شامل دوش شیر مخلوط و مانند آن.", "unit": "دستگاه", "price": 510000, "type": "Base"},
    {"item_id": "010815", "description": "برچیدن لوله های آزبست سیمان لوله های پیش ساخته سیمانی یا چدنی غیر مدفون", "unit": "متر طول", "price": 318500, "type": "Base"},
    {"item_id": "010816", "description": "برچیدن لوله های آزبست سیمان لوله های پیش ساخته سیمانی یا چدنی مدفون در مصالح بنایی", "unit": "متر طول", "price": 364000, "type": "Base"},
    {"item_id": "010901", "description": "کندن آسفالت بام به ضخامت تا ۲ سانتی متر.", "unit": "متر مربع", "price": 483000, "type": "Base"},
    {"item_id": "010902", "description": "اضافه بها به ردیف ۰۱۰۹۰۱ به ازای هر سانتی متر اضافه ضخامت نسبت به مازاد ۲ سانتی متر کسر سانتی متر به تناسب محاسبه میشود.", "unit": "متر مربع", "price": 161000, "type": "AddedValue"},
    {"item_id": "010903", "description": "کندن آسفالت برای لکه گیری به ضخامت تا ۵ سانتی متر بر حسب سطح کنده شده.", "unit": "متر مربع", "price": 774500, "type": "Base"},
    {"item_id": "010904", "description": "اضافه بها به ردیف ۰۱۰۹۰۳ به ازای هر سانتی متر اضافه ضخامت مازاد بر ۵ سانتی متر کسر) سانتی متر به تناسب محاسبه می شود.", "unit": "متر مربع", "price": 141000, "type": "AddedValue"},
    {"item_id": "010905", "description": "شیار انداختن و کندن آسفالت به عرض تا ۸ سانتی متر و عمق تا ۱۰ سانتی متر با ماشین شیارزن", "unit": "مترطول", "price": 428500, "type": "Base"},
    {"item_id": "010906", "description": "اضافه بها به ردیف ۰۱۰۹۰۵ به ازای هر سانتی متر اضافه عمق مازاد بر ۱۰ سانتی متر کسر) سانتی متر به تناسب محاسبه می شود.", "unit": "مترطول", "price": 42800, "type": "AddedValue"},
    {"item_id": "010907", "description": "برش آسفالت با کاتر به عمق تا ۷ سانتی متر اندازه گیری بر حسب طول هر خط برش", "unit": "مترطول", "price": 144500, "type": "Base"},
    {"item_id": "010908", "description": "اضافه بها به ردیف ۰۱۰۹۰۷ به ازای هر سانتی متر اضافه عمق مازاد بر ۷ سانتی متر اندازه گیری بر حسب طول هر خط برش کسر) سانتی متر به تناسب محاسبه میشود.", "unit": "مترطول", "price": 15800, "type": "AddedValue"},
    {"item_id": "010909", "description": "تخریب کلی آسفالت به ضخامت تا ۵ سانتی متر", "unit": "متر مربع", "price": 282500, "type": "Base"},
    {"item_id": "010910", "description": "اضافه بها به ردیف ۰۱۰۹۰۹، به ازای هر سانتی متر اضافه ضخامت مازاد بر ۵ سانتی متر کسر) سانتی متر به تناسب محاسبه می شود.", "unit": "متر مربع", "price": 42400, "type": "AddedValue"},
    {"item_id": "010911", "description": "تراشیدن آسفالت به صورت پیوسته با ماشین مخصوص آسفالت تراش به ضخامت تا ۵ سانتی متر", "unit": "متر مربع", "price": 420000, "type": "Base"},
    {"item_id": "010912", "description": "اضافه بها به ردیف ۰۱۰۹۱۱ به ازای هر سانتی متر اضافه ضخامت مازاد بر ۵ سانتی متر کسر) سانتی متر به تناسب محاسبه می شود.", "unit": "متر مربع", "price": 69000, "type": "AddedValue"},
    {"item_id": "010913", "description": "تخریب آسفالت بین دو خط برش با فاصله حداکثر ۱۵ متر با وسایل مکانیکی مانند کمپرسور یا بیل هیدرولیکی به ضخامت تا ۷ سانتی متر و برداشتن آن.", "unit": "متر مربع", "price": 60500, "type": "Base"},
    {"item_id": "010914", "description": "اضافه بها به ردیف ۰۱۰۹۱۳ به ازای هر سانتی متر اضافه ضخامت مازاد بر ۷ سانتی متر کسر) سانتی متر به تناسب محاسبه می شود.", "unit": "متر مربع", "price": 22000, "type": "AddedValue"},
    {"item_id": "010915", "description": "تراشیدن آسفالت برای لکه گیری به صورت غیر پیوسته و پراکنده با ماشین مخصوص آسفالت تراش به ضخامت تا ۵ سانتی متر.", "unit": "متر مربع", "price": 537000, "type": "Base"},
    {"item_id": "010916", "description": "اضافه بها به ردیف ۰۱۰۹۱۵ به ازای هر سانتی متر اضافه ضخامت مازاد بر ۵ سانتی متر کسر) سانتی متر به تناسب محاسبه می شود.", "unit": "متر مربع", "price": 71600, "type": "AddedValue"}, # تصحیح شد
    {"item_id": "010920", "description": "برش بتن به انضمام بریدن میلگردها با کاتر به ضخامت تا ۱۵ سانتی متر اندازه گیری بر حسب هر خط برش).", "unit": "متر طول", "price": 1647000, "type": "Base"}, # تصحیح شد
    {"item_id": "010921", "description": "اضافه بها نسبت به ردیف ۰۱۰۹۲۰ به ازای هر سانتی متر اضافه ضخامت مازاد بر ۱۵ سانتی متر تا ۲۵ سانتی متر کسر سانتی متر به تناسب محاسبه می شود.", "unit": "متر طول", "price": 131500, "type": "AddedValue"}
]

# --- ۳. اسکریپت بارگذاری در Neo4j ---

class Neo4jLoader:
    def __init__(self, uri, user, password):
        try:
            self.driver = GraphDatabase.driver(uri, auth=(user, password))
            self.driver.verify_connectivity()
            print("✅ اتصال به Neo4j با موفقیت برقرار شد.")
        except Exception as e:
            print(f"❌ خطای اتصال: {e}")
            exit()

    def close(self):
        self.driver.close()

    def load_chapter_01_data(self, chapter, groups, items):
        """
        بارگذاری تمام گره‌ها و روابط اولیه فصل ۰۱ در Neo4j
        """
        with self.driver.session(database="BrainDB") as session: # مشخص کردن نام پایگاه داده
            
            # --- الف) ایجاد گره فصل ---
            print(f"\n۱. در حال ایجاد گره برای: {chapter['title']}")
            session.run("MERGE (c:Chapter {chapter_id: $id}) SET c.title = $title", 
                        id=chapter['chapter_id'], title=chapter['title'])

            # --- ب) ایجاد گره‌های گروه‌ها و اتصال به فصل ---
            print(f"۲. در حال ایجاد {len(groups)} گره گروه و اتصال به فصل ۰۱...")
            for group in groups:
                session.run("""
                    MATCH (c:Chapter {chapter_id: $chapter_id})
                    MERGE (g:Group {group_id: $group_id})
                    SET g.title = $title
                    MERGE (g)-[:BELONGS_TO]->(c)
                """, chapter_id=chapter['chapter_id'], group_id=group['group_id'], title=group['title'])

            # --- ج) ایجاد گره‌های ردیف‌ها و اتصال به گروه‌ها ---
            print(f"۳. در حال ایجاد {len(items)} گره ردیف و اتصال به گروه‌های مربوطه...")
            count = 0
            for item in items:
                group_id_prefix = item['item_id'][:4]
                
                session.run("""
                    MATCH (g:Group {group_id: $group_id})
                    MERGE (i:Item {item_id: $item_id})
                    SET i.description = $desc,
                        i.unit = $unit,
                        i.price = $price,
                        i.item_type = $type
                    MERGE (i)-[:BELONGS_TO]->(g)
                """, 
                group_id=group_id_prefix, 
                item_id=item['item_id'], 
                desc=item['description'], 
                unit=item['unit'], 
                price=item['price'], 
                type=item['type'])
                
                count += 1
                if count % 20 == 0:
                    print(f"   ... {count} ردیف از {len(items)} ایجاد شد ...")

            print(f"✅ تمام {len(items)} ردیف با موفقیت در Neo4j بارگذاری شدند.")
            
    def link_modifier_items(self):
        """
        برقراری روابط 'ADDS_TO' و 'SUBTRACTS_FROM'
        """
        print("\n۴. در حال برقراری روابط 'اضافه بها' و 'کسر بها'...")
        
        with self.driver.session(database="BrainDB") as session:
            relations_to_create = [
                ("010122", "ADDS_TO", "010121"),
                ("010124", "ADDS_TO", "010123"),
                ("010126", "ADDS_TO", "010125"),
                ("010209", "ADDS_TO", "010208"),
                ("010212", "ADDS_TO", "010211"),
                ("010710", "ADDS_TO", "010705"),
                ("010902", "ADDS_TO", "010901"),
                ("010904", "ADDS_TO", "010903"),
                ("010906", "ADDS_TO", "010905"),
                ("010908", "ADDS_TO", "010907"),
                ("010910", "ADDS_TO", "010909"),
                ("010912", "ADDS_TO", "010911"),
                ("010914", "ADDS_TO", "010913"),
                ("010916", "ADDS_TO", "010915"),
                ("010921", "ADDS_TO", "010920"),
                ("010517", "SUBTRACTS_FROM", "010502"),
                ("010517", "SUBTRACTS_FROM", "010503"),
                ("010517", "SUBTRACTS_FROM", "010505"),
            ]
            
            count = 0
            for source_id, rel_type, target_id in relations_to_create:
                session.run(f"""
                    MATCH (source:Item {{item_id: $source_id}})
                    MATCH (target:Item {{item_id: $target_id}})
                    MERGE (source)-[:{rel_type}]->(target)
                """, source_id=source_id, target_id=target_id)
                count += 1
            
            print(f"✅ {count} رابطه 'اضافه/کسر بها' با موفقیت ایجاد شد.")

# --- ۴. اجرای اسکریپت ---
if __name__ == "__main__":
    print("--- شروع بارگذاری داده‌های فصل ۰۱ در Neo4j ---")
    
    loader = Neo4jLoader(NEO4J_URI, NEO4J_USER, NEO4J_PASSWORD)
    
    # اجرای بارگذاری گره‌ها
    loader.load_chapter_01_data(chapter_data, groups_data, items_data)
    
    # اجرای برقراری روابط
    loader.link_modifier_items()
    
    loader.close()
    print("\n--- عملیات بارگذاری داده‌های پایه فصل ۰۱ با موفقیت پایان یافت ---")